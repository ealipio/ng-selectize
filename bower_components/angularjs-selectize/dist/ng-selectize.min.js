/*! ng-selectize - v0.1.6 - 2014-01-22 | https://github.com/preventdefault/ng-selectize.git | MIT License */
angular.module("ngSelectize",[]).directive("ngSelectize",function(){"use strict";function a(a){return angular.extend({sortField:"$order"},a||{})}function b(a){var b=a.val(),c=a.text();if((b||c)&&("?"!==b||c))return!b&&c&&(b="?"),{text:c||"",value:b||""}}function c(a){var b=a.attr("data-data");return"string"==typeof b&&b.length?JSON.parse(b):null}function d(a){var b={options:[],optgroups:{},items:[]};return h(a,b),b}function e(a,b){b.length&&(a.addOption(b),a.refreshOptions(!1))}function f(a,b){if(Array.isArray(b))return b.forEach(function(b){f(a,b)}),void 0;var c=a.getOption(b);a.addItem(b),a.setActiveOption(c,!1)}function g(a){var b=a.nodeName.toLowerCase();if("select"!==b)throw new Error("Invalid element given.")}var h=function(a,d){var e,f,g,h,i=0,j=d.options,k=function(a,c){var e;a=$(a),e=b(a),e&&(e.optgroup=c,e.$order=++i,j.push(e),a.is(":selected")&&d.items.push(e.value))},l=function(a){var b,e,f,g,h;for(a=$(a),f=a.attr("label"),f&&(g=c(a)||{},g.label=f,g.value=f,d.optgroups[f]=g),h=$("option",a),b=0,e=h.length;e>b;b++)k(h[b],f)};for(d.maxItems=a.attr("multiple")?null:1,h=a.children(),e=0,f=h.length;f>e;e++)g=h[e].tagName.toLowerCase(),"optgroup"===g?l(h[e]):"option"===g&&k(h[e])};return{restrict:"A",require:"ngModel",priority:1e3,link:function(b,c,h,i){function j(){var a=this.getValue();Array.isArray(a)||(a=[a]),c.children("option").prop("selected",!1).filter(function(){return a.indexOf(this.value)>-1}).prop("selected",!0).end().end().trigger("change")}function k(){q(),clearTimeout(o),o=setTimeout(function(){p=d(c),l&&angular.equals(l,p)||(l=p,n.clearOptions(),angular.forEach(p.optgroups,function(a,b){n.addOptionGroup(b,a)}),e(n,p.options),f(n,p.items))},0)}var l,m,n,o,p,q=i.$render,r=a(b.$eval(h.ngSelectize));angular.isDefined(h.ngOptions)&&(m=c.selectize(r),n=m[0].selectize,n.updateOriginalInput=angular.noop,i.$render=k),angular.isDefined(h.ngOptions)||(g(c[0]),p=d(c),m=c.selectize(r),n=m[0].selectize,setTimeout(function(){n.clearOptions(),e(n,p.options)},0),c.on("change",function(){"?"===n.getValue()&&(i.$setViewValue(null),b.$apply())}),i.$render=function(){clearTimeout(o),o=setTimeout(function(){f(n,i.$modelValue)},0)}),n.on("item_add",j),n.on("item_remove",j),b.$watch(i.$render),b.$on("$destroy",function(){n.destroy(),clearTimeout(o)})}}});