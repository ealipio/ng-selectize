/*! ng-selectize - v0.1.2 - 2013-12-28 | https://github.com/preventdefault/ng-selectize.git | MIT License */
angular.module("ngSelectize",[]).directive("ngSelectize",function(){function a(a){return angular.extend({sortField:"$order"},a||{})}function b(a){var b=a.val(),c=a.text();if((b||c)&&("?"!==b||c))return!b&&c&&(b="?"),{text:c||"",value:b||""}}function c(a){var b=a.attr("data-data");return"string"==typeof b&&b.length?JSON.parse(b):null}function d(a){var b={options:[],optgroups:{},items:[]};return g(a,b),b}function e(a,b){b.length&&(a.addOption(b),a.refreshOptions(!1))}function f(a,b){if(Array.isArray(b))return b.forEach(function(b){f(a,b)}),void 0;var c=a.getOption(b);a.addItem(b),a.setActiveOption(c,!1)}var g=function(a,d){var e,f,g,h,i=0,j=d.options,k=function(a,c){var e;a=$(a),(e=b(a))&&(e.optgroup=c,e.$order=++i,j.push(e),a.is(":selected")&&d.items.push(e.value))},l=function(a){var b,e,f,g,h;for(a=$(a),f=a.attr("label"),f&&(g=c(a)||{},g.label=f,g.value=f,d.optgroups[f]=g),h=$("option",a),b=0,e=h.length;e>b;b++)k(h[b],f)};for(d.maxItems=a.attr("multiple")?null:1,h=a.children(),e=0,f=h.length;f>e;e++)g=h[e].tagName.toLowerCase(),"optgroup"===g?l(h[e]):"option"===g&&k(h[e])};return{restrict:"A",require:"ngModel",priority:1e3,link:function(b,c,g,h){function i(){var a=this.getValue();Array.isArray(a)||(a=[a]),c.children("option").prop("selected",!1).filter(function(){return a.indexOf(this.value)>-1}).prop("selected",!0).end().end().trigger("change")}function j(){p(),clearTimeout(n),n=setTimeout(function(){o=d(c),k&&angular.equals(k,o)||(k=o,m.clearOptions(),angular.forEach(o.optgroups,function(a,b){m.addOptionGroup(b,a)}),e(m,o.options),f(m,o.items))},0)}var k,l,m,n,o,p=h.$render,q=a(b.$eval(g.ngSelectize));angular.isDefined(g.ngOptions)&&(l=c.selectize(q),m=l[0].selectize,m.updateOriginalInput=angular.noop,h.$render=j),angular.isDefined(g.ngOptions)||(o=d(c),l=c.selectize(q),m=l[0].selectize,m.clearOptions(),e(m,o.options),c.on("change",function(){"?"===m.getValue()&&(h.$setViewValue(null),b.$apply())}),h.$render=function(){clearTimeout(n),n=setTimeout(function(){f(m,h.$modelValue)},0)}),m.on("item_add",i),m.on("item_remove",i),b.$watch(h.$render),b.$on("$destroy",function(){m.destroy(),clearTimeout(n)})}}});