/*! ng-selectize - v0.1.6 - 2014-02-01 | https://github.com/preventdefault/ng-selectize.git | MIT License */
angular.module("ngSelectize",[]).directive("ngSelectize",["$parse",function(a){"use strict";function b(a){return angular.extend({sortField:"$order"},a||{})}function c(a){var b=a.val(),c=a.text();if((b||c)&&("?"!==b||c))return!b&&c&&(b="?"),{text:c||"",value:b||""}}function d(a){var b=a.attr("data-data");return"string"==typeof b&&b.length?JSON.parse(b):null}function e(a,b){var e,f,g,h,i=0,j=b.options,k=function(a,d){var e;a=$(a),e=c(a),e&&(e.optgroup=d,e.$order=++i,j.push(e),a.is(":selected")&&b.items.push(e.value))},l=function(a){var c,e,f,g,h;for(a=$(a),f=a.attr("label"),f&&(g=d(a)||{},g.label=f,g.value=f,b.optgroups[f]=g),h=$("option",a),c=0,e=h.length;e>c;c++)k(h[c],f)};for(b.maxItems=a.attr("multiple")?null:1,h=a.children(),e=0,f=h.length;f>e;e++)g=h[e].tagName.toLowerCase(),"optgroup"===g?l(h[e]):"option"===g&&k(h[e])}function f(a){var b={options:[],optgroups:{},items:[]};return e(a,b),b}function g(a,b){b.length&&(a.addOption(b),a.refreshOptions(!1))}function h(a,b){if(Array.isArray(b))return b.forEach(function(b){h(a,b)}),void 0;var c=a.getOption(b);a.addItem(b),a.setActiveOption(c,!1)}function i(a){var b=a.nodeName.toLowerCase();if("select"!==b)throw new Error("Invalid element given.")}function j(a,b){return function(c){return a(b)[c]}}function k(a){if(a.provider&&a.provider[a.method]){var b=a.provider[a.method];a.provider[a.method]=function(c,d){return b.call(this,a.valueFn(c.value),d)}}}var l=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/;return{restrict:"A",require:"ngModel",priority:1e3,scope:{ngSelectize:"="},link:function(c,d,e,m){function n(){var a=this.getValue();Array.isArray(a)||(a=[a]),d.children("option").prop("selected",!1).filter(function(){return a.indexOf(this.value)>-1}).prop("selected",!0).end().end().trigger("change")}function o(){w(),clearTimeout(s),s=setTimeout(function(){t=f(d),p&&angular.equals(p,t)||(p=t,r.clearOptions(),angular.forEach(t.optgroups,function(a,b){r.addOptionGroup(b,a)}),g(r,t.options),h(r,t.items))},0)}var p,q,r,s,t,u,v,w=m.$render,x=b(c.ngSelectize),y=(e.ngOptions||"").match(l);angular.isDefined(e.ngOptions)&&(u=a(y[7]),v=j(u,c.$parent),["option","item"].forEach(function(a){k({provider:x.render,method:a,valueFn:v})}),q=d.selectize(x),r=q[0].selectize,r.updateOriginalInput=angular.noop,m.$render=o),angular.isDefined(e.ngOptions)||(i(d[0]),t=f(d),q=d.selectize(x),r=q[0].selectize,setTimeout(function(){r.clearOptions(),g(r,t.options)},0),d.on("change",function(){"?"===r.getValue()&&(m.$setViewValue(null),c.$apply())}),m.$render=function(){clearTimeout(s),s=setTimeout(function(){h(r,m.$modelValue)},0)}),r.on("item_add",n),r.on("item_remove",n),c.$watch(m.$render),c.$on("$destroy",function(){r.destroy(),clearTimeout(s)})}}}]);