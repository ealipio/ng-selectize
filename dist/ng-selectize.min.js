/*! ng-selectize - v0.0.1 - 2013-12-18 | https://github.com/preventdefault/ng-selectize.git | MIT License */
angular.module("ngSelectize",[]).directive("ngSelectize",function(){function a(a){return angular.extend({sortField:"$order"},a||{})}function b(a){var b=a.val(),c=a.text();if((b||c)&&("?"!==b||c))return!b&&c&&(b="?"),{text:c||"",value:b||""}}function c(a){var b={options:[],optgroups:{},items:[]};return f(a,b),b}function d(a,b){b.length&&(a.addOption(b),a.refreshOptions(!1))}function e(a,b){if(Array.isArray(b))return b.forEach(function(b){e(a,b)}),void 0;var c=a.getOption(b);a.addItem(b),a.setActiveOption(c,!1)}var f=function(a,c){var d,e,f,g,h=0,i=c.options,j=function(a){var b=a.attr("data-data");return"string"==typeof b&&b.length?JSON.parse(b):null},k=function(a,d){var e;a=$(a),(e=b(a))&&(e.optgroup=d,e.$order=++h,i.push(e),a.is(":selected")&&c.items.push(e.value))},l=function(a){var b,d,e,f,g;for(a=$(a),e=a.attr("label"),e&&(f=j(a)||{},f.label=e,f.value=e,c.optgroups[e]=f),g=$("option",a),b=0,d=g.length;d>b;b++)k(g[b],e)};for(c.maxItems=a.attr("multiple")?null:1,g=a.children(),d=0,e=g.length;e>d;d++)f=g[d].tagName.toLowerCase(),"optgroup"===f?l(g[d]):"option"===f&&k(g[d])};return{restrict:"A",require:"ngModel",priority:1e3,link:function(b,f,g,h){function i(){var a=this.getValue();Array.isArray(a)||(a=[a]),f.children("option").prop("selected",!1).filter(function(){return a.indexOf(this.value)>-1}).prop("selected",!0).end().trigger("change")}function j(){p(),clearTimeout(n),n=setTimeout(function(){o=c(f),k&&angular.equals(k,o)||(k=o,m.clearOptions(),angular.forEach(o.optgroups,function(a,b){m.addOptionGroup(b,a)}),d(m,o.options),e(m,o.items))},0)}var k,l,m,n,o,p=h.$render,q=a(b.$eval(g.ngSelectize));angular.isDefined(g.ngOptions)&&(l=f.selectize(q),m=l[0].selectize,m.updateOriginalInput=angular.noop,h.$render=j),angular.isDefined(g.ngOptions)||(o=c(f),l=f.selectize(q),m=l[0].selectize,m.clearOptions(),d(m,o.options),f.on("change",function(){"?"===m.getValue()&&(h.$setViewValue(null),b.$apply())}),h.$render=function(){clearTimeout(n),n=setTimeout(function(){e(m,h.$modelValue)},0)}),m.on("item_add",i),m.on("item_remove",i),b.$watch(h.$render),b.$on("$destroy",function(){m.destroy(),clearTimeout(n)})}}});